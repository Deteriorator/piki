var UMLNote=function(b){var a=new Rectangular(b);a.setType("UMLNote");a.setMoveable();a.setWidth(100);a.setHeight(50);a.addFigure(new NoteFigure({color:ApplicationValues.element_color}));a.addComponent(new StereotypeFields({id:"stereotypes",centered:true}));a.addComponent(new TextArea({id:"description",text:"Note",centered:true,margin:5}));a.setMenu([[function(){a.showColorDialog({that:a});a.removeContextualMenu()},"Style"]]);return a};var UMLLine=function(b){var a=new Line(b);a.setType("UMLLine");a.setLine(new DashedLine());return a};test="";var ApplicationValues={element_color:"#ffffbb",dialog:new Dialog()};var Application=function(a){a=a||{};if(!(a.id&&a.width&&a.height)){return}this._width=a.width;this._height=a.height;this._generateStructure(a.id);this._generateGeneralMenu();this._selected=null;this._diagrams=[];this._tabs=[]};var _acceptedDiagrams=[];var _genericMenu=[];var _specificMenu=[];Application.prototype._generateStructure=function(b){var g=document.getElementById(b);var d=document.createElement("div");d.setAttribute("id","ud_tools_div");var f=document.createElement("ul");f.setAttribute("id","ud_tools_ul1");var e=document.createElement("ul");e.setAttribute("id","ud_tools_ul2");d.appendChild(f);d.appendChild(e);g.appendChild(d);this._tools_div=d;this._tools_ul1=f;this._tools_ul2=e;var j=document.createElement("div");j.setAttribute("id","ud_container_div");var l=document.createElement("div");l.setAttribute("id","ud_selector_div");var a=document.createElement("ul");a.setAttribute("id","ud_selector_ul");l.appendChild(a);j.appendChild(l);this._selector_ul=a;var h=document.createElement("div");h.setAttribute("id","ud_diagram_div");h.setAttribute("class","ud_diagram_div");h.style.width=this._width+"px";h.style.height=this._height+"px";this._diagram_div=h;j.appendChild(h);g.appendChild(j);var c;c=document.createElement("canvas");c.setAttribute("class","ud_diagram_canvas");c.width=this._width;c.height=this._height;h.appendChild(c);this._mainContext=c.getContext("2d");this._mainCanvas=c;c=document.createElement("canvas");c.setAttribute("class","ud_diagram_canvas");c.width=this._width;c.height=this._height;c.onmousedown=function(){return false};h.appendChild(c);this._motionContext=c.getContext("2d");var k=document.createElement("div");k.setAttribute("id","ud_delete_div");h.appendChild(k);var i=this;k.onclick=function(){ApplicationValues.dialog._text='Do you want to delete the diagram "'+i._diagrams[i._selected].getName()+'"?';ApplicationValues.dialog._cancelable=true;if(i._selected){ApplicationValues.dialog.show(function(){i._delDiagram();i._generateSpecificMenu()})}}};Application.prototype._changeTabName=function(c){var e=this._diagrams[c].getName();if(e.length>20){e=e.substring(0,17);e+="..."}var b=this._tabs[c];var d=b.firstChild;var a=d.firstChild;d.removeChild(a);d.appendChild(document.createTextNode(e))};Application.prototype._addTab=function(b){var a=document.createElement("li");var d=document.createElement("a");d.appendChild(document.createTextNode(""));a.appendChild(d);this._selector_ul.appendChild(a);this._tabs[b]=a;var c=this;a.onclick=function(){if(c._selected==b){ApplicationValues.dialog._text="Diagram name:";ApplicationValues.dialog._cancelable=true;var e=c._diagrams[b];ApplicationValues.dialog.show(function(f){if(f==""){f="Untitle"}e.setName(f);c._changeTabName(b);e.draw()},e.getName())}else{c._selectDiagram(b)}};this._changeTabName(b)};Application.prototype._delTab=function(a){this._selector_ul.removeChild(this._tabs[a]);delete this._tabs[a]};Application.prototype._generateIndex=function(){var a=Math.random();while(true){if(a in this._diagrams){a=Math.random()}else{return a}}};Application.prototype.addDiagram=function(a){var b=this._generateIndex();a.initialize(b,this._diagram_div,this._mainContext,this._motionContext,this._width,this._height);this._diagrams[b]=a;this._diagrams[b].setUpdateHeightCanvas(true);this._addTab(b);this._selectDiagram(b)};Application.prototype._delDiagram=function(){var a=this._selected;if(a){this._diagrams[a].interaction(false);this._delTab(a);delete this._diagrams[a];this._selected=null;var b;for(b in this._diagrams){this._selectDiagram(b);return}this._clearCanvas()}};Application.prototype._clearCanvas=function(){this._mainContext.clearRect(0,0,this._width,this._height);this._motionContext.clearRect(0,0,this._width,this._height)};Application.prototype._selectDiagram=function(a){if(this._selected){this._diagrams[this._selected].interaction(false);this._tabs[this._selected].removeAttribute("class")}this._clearCanvas();this._diagrams[a].draw();this._diagrams[a].interaction(true);this._selected=a;this._tabs[a].setAttribute("class","active");this._generateSpecificMenu()};Application.prototype._getDiagramImage=function(){if(this._selected){this._diagrams[this._selected].stopEvents();this._diagrams[this._selected].draw();return this._mainCanvas.toDataURL("image/png")}};Application.prototype._generateGeneralMenu=function(){var e=this;var g=this._tools_div;var c=document.createElement("h1");var f=document.createTextNode("Actions");var b=document.createElement("img");b.setAttribute("src","img/app/vertical_flow.png");c.appendChild(b);c.appendChild(f);g.insertBefore(c,this._tools_ul1);c.onclick=function(){var j=document.getElementById("ud_tools_ul1");var h;if(j.style.display=="none"){j.style.display="block";this.childNodes[0].setAttribute("src","img/app/vertical_flow.png")}else{j.style.display="none";this.childNodes[0].setAttribute("src","img/app/horizontal_flow.png")}};this._addMenuItem(this._tools_ul1,"Export/Import to xml",function(l){var o=this;this._active=true;var h=document.createElement("div");var i=document.createElement("form");var j=document.createElement("textarea");var t=document.createElement("input");var p=document.createElement("input");var s=document.createElement("input");var r=document.createElement("input");h.className="ud_popup";j.setAttribute("rows",15);j.setAttribute("cols",90);t.setAttribute("type","submit");t.setAttribute("value","Import");p.setAttribute("type","submit");p.setAttribute("value","Export All");s.setAttribute("type","submit");s.setAttribute("value","Export Current Diagram");r.setAttribute("type","submit");r.setAttribute("value","x");var m=function(u){l.setXMLString(j.value);document.body.removeChild(h)};var q=function(u){j.value=l.getXMLString();j.select()};var k=function(u){j.value=l.getCurrentXMLString();j.select()};var n=function(u){document.body.removeChild(h)};i.onsubmit=function(){return false};p.addEventListener("click",q,false);s.addEventListener("click",k,false);t.addEventListener("click",m,false);r.addEventListener("click",n,false);i.appendChild(p);i.appendChild(s);i.appendChild(t);i.appendChild(r);i.appendChild(document.createElement("br"));i.appendChild(j);h.appendChild(i);document.body.appendChild(h);j.focus();h.style.top=(window.innerHeight-i.offsetHeight)/2+"px";h.style.left=(window.innerWidth-i.offsetWidth)/2+"px"},0,"import_export");this._addMenuItem(this._tools_ul1,"Generate image (png)",function(j,i){if(j._selected){var h=window.open(j._getDiagramImage(),"diagramImage","height="+(j._height+70)+",width="+(j._width+20));h.focus()}else{alert("You did not select any diagram")}},0,"generate_image");this._addMenuItem(this._tools_ul1,"Delete object",function(j,h,o){var m=j.getElementByPoint(h,o);if(m){var n=false;var l="";for(var i=0;i<m._components.length&&!n;i++){if(m._components[i].getId()=="name"){l=m._components[i]._text;n=true}}if(l!=""){l=' "'+l+'" '}ApplicationValues.dialog._text="Do you want to delete the object"+l+" ("+m.getType()+") ?";ApplicationValues.dialog._cancelable=true}if(m!=null&&m instanceof Element){ApplicationValues.dialog.show(function(){j.delElement(m);j.draw()})}},1,"delete_object");this._addMenuItem(this._tools_ul1,"Modify color",function(w){var q=ApplicationValues.element_color;var y=ApplicationValues.element_color.split("#")[1];var B=new Array(parseInt(y.slice(0,2),16),parseInt(y.slice(2,4),16),parseInt(y.slice(4,6),16));var z=document.createElement("div");z.className="ud_popupColor";var I=document.createElement("div");I.setAttribute("id","divBlock1");var H=document.createElement("div");H.setAttribute("id","divBlock2");var m=document.createElement("div");m.setAttribute("id","colorHtml");m.style.color="#ffffff";var h=document.createElement("div");h.setAttribute("id","red");var x=document.createElement("canvas");x.setAttribute("id","R");x.width=150;x.height=20;h.appendChild(x);var i=x.getContext("2d");var r=document.createElement("div");r.setAttribute("id","green");var A=document.createElement("canvas");A.setAttribute("id","G");A.width=150;A.height=20;r.appendChild(A);var s=A.getContext("2d");var u=document.createElement("div");u.setAttribute("id","blue");var C=document.createElement("canvas");C.setAttribute("id","B");C.width=150;C.height=20;u.appendChild(C);var v=C.getContext("2d");var t=document.createElement("div");t.setAttribute("id","divSelectColor");var F=document.createElement("canvas");F.setAttribute("id","selectColor");F.width=90;F.height=90;t.appendChild(F);var k=F.getContext("2d");var l=document.createElement("form");var J=document.createElement("input");J.setAttribute("type","submit");J.setAttribute("value","ok");var G=document.createElement("input");G.setAttribute("type","submit");G.setAttribute("value","cancel");var E=function(K){document.body.removeChild(z)};var p=function(K){ApplicationValues.element_color=q;document.body.removeChild(z)};J.addEventListener("click",E,false);G.addEventListener("click",p,false);l.onsubmit=function(){return false};J.focus();l.appendChild(J);l.appendChild(G);I.appendChild(m);I.appendChild(h);I.appendChild(r);I.appendChild(u);I.appendChild(l);z.appendChild(I);H.appendChild(t);H.appendChild(document.createElement("div"));z.appendChild(H);var D=function(M,L,N,K){if(N==0){N=0.1}else{if(N==120){N=119.9}}L.save();L.font="12px monospace";L.textBaseline="middle";L.fillStyle="#ffffff";L.fillText(M.getAttribute("id"),0,M.height/2);L.restore();L.save();L.beginPath();L.fillStyle=K;L.fillRect(20,0,parseInt(M.width)-50,x.height);L.closePath();L.restore();L.fillStyle="#000000";L.beginPath();L.arc(20+(N*100)/255,parseInt(M.height)/2,4,0,Math.PI*2,true);L.closePath();L.fill();L.save();L.font="12px monospace";L.textBaseline="middle";L.fillStyle="#ffffff";L.fillText(parseInt(N),125,M.height/2);L.restore()};var o=function(K){k.save();k.beginPath();k.fillStyle=K;k.fillRect(20,20,80,80);k.closePath();k.restore()};var n=function(M){var L=function(Q){var O="0123456789ABCDEF";var N=parseInt(Q)%16;var P=(parseInt(Q)-N)/16;hex=""+O.charAt(P)+O.charAt(N);return hex};var K=L(M[0])+L(M[1])+L(M[2]);while(m.hasChildNodes()){m.removeChild(m.lastChild)}m.appendChild(document.createTextNode("#"));m.appendChild(document.createTextNode(K));ApplicationValues.element_color="#"+K};var j=function(M){var L=M.pageX-z.offsetLeft-this.offsetLeft;var K=M.pageY-this.offsetTop;if(this.getAttribute("id")=="red"){B[0]=((L-20)*255)/100;if(B[0]>255){B[0]=255}if(B[0]<0){B[0]=0}i.clearRect(0,0,parseInt(x.width),x.height);D(x,i,B[0],"#ff0000")}if(this.getAttribute("id")=="green"){B[1]=((L-20)*255)/100;if(B[1]>255){B[1]=255}if(B[1]<0){B[1]=0}s.clearRect(0,0,parseInt(A.width),A.height);D(A,s,B[1],"#00ff00")}if(this.getAttribute("id")=="blue"){B[2]=((L-20)*255)/100;if(B[2]>255){B[2]=255}if(B[2]<0){B[2]=0}v.clearRect(0,0,parseInt(C.width),C.height);D(C,v,B[2],"#0000ff")}n(B);o(ApplicationValues.element_color)};D(x,i,B[0],"#ff0000");D(A,s,B[1],"#00ff00");D(C,v,B[2],"#0000ff");o(ApplicationValues.element_color);n(B);h.addEventListener("mousedown",j,false);r.addEventListener("mousedown",j,false);u.addEventListener("mousedown",j,false);document.body.appendChild(z);z.style.top=(window.innerHeight-parseInt(z.offsetHeight))/2+"px";z.style.left=(window.innerWidth-parseInt(z.offsetWidth))/2+"px"},0,"modify_color");var a=_genericMenu;var d;for(d in a){if(a[d].length==3){this._addMenuItem(this._tools_ul1,a[d][0],a[d][1],a[d][2])}else{if(a[d].length==4){this._addMenuItem(this._tools_ul1,a[d][0],a[d][1],a[d][2],a[d][3])}}}g=this._tools_div;c=document.createElement("h1");f=document.createTextNode("Diagram elements");c.onclick=function(){var j=document.getElementById("ud_tools_ul2");var h;if(j.style.display=="none"){j.style.display="block";this.childNodes[0].setAttribute("src","img/app/vertical_flow.png")}else{j.style.display="none";this.childNodes[0].setAttribute("src","img/app/horizontal_flow.png")}};b=document.createElement("img");b.setAttribute("src","img/app/vertical_flow.png");c.appendChild(b);c.appendChild(f);g.insertBefore(c,this._tools_ul2)};Application.prototype._generateSpecificMenu=function(){var c;var d=this._tools_ul2;while(d.hasChildNodes()){d.removeChild(d.firstChild)}if(this._selected){var c,b;var a=_specificMenu[this._diagrams[this._selected].getType()];for(c in a){if(a[c].length==4){this._addMenuItem(this._tools_ul2,a[c][0],a[c][1],a[c][2],a[c][3])}else{if(a[c].length==3){this._addMenuItem(this._tools_ul2,a[c][0],a[c][1],a[c][2])}}}this._addMenuItem(this._tools_ul2,"Note",function(f,e,g){f.addElement(new UMLNote({x:e,y:g}))},1,"UMLNote");this._addMenuItem(this._tools_ul2,"Anchor",function(j,i,l,h,k){var g=j.getElementByPoint(i,l);var f=j.getElementByPoint(h,k);if(g!=null){if(!f){f=new UMLNote({x:h,y:k});j.addElement(f)}var e=new UMLLine({a:g,b:f});j.addElement(e)}},2,"UMLAnchor")}};Application.prototype._interactionSingleClick=function(d){var b=this._diagrams[this._selected];b.interaction(false);var c=this;var a=function(g){var f=g.pageX-c._diagram_div.offsetLeft;var e=g.pageY-c._diagram_div.offsetTop;d(b,f,e);c._diagram_div.onclick=false;b.draw();b.interaction(true)};this._diagram_div.onclick=a};Application.prototype._interactionDoubleClick=function(g){var c=this._diagrams[this._selected];c.interaction(false);var b=0,d=0;var f=true;var e=this;var a=function(j){var i=j.pageX-e._diagram_div.offsetLeft;var h=j.pageY-e._diagram_div.offsetTop;if(first){first=false;b=i;d=h}else{g(c,b,d,i,h);e._diagram_div.onclick=false;c.draw();c.interaction(true)}};this._diagram_div.onclick=a};Application.prototype._addMenuItem=function(a,g,f,j,b){var h=document.createElement("li");var e=document.createElement("a");var i=document.createTextNode(g);if(b){var c=document.createElement("img");c.setAttribute("src","img/app/"+b+".png");h.appendChild(c)}e.appendChild(i);h.appendChild(e);a.appendChild(h);var d=this;switch(j){case 0:h.addEventListener("click",function(){if(d._selected){f(d,d._diagrams[d._selected])}else{f(d)}},false);break;case 1:h.addEventListener("click",function(){if(d._selected){d._interactionSingleClick(f)}},false);break;case 2:h.addEventListener("click",function(){if(d._selected){d._interactionDoubleClick(f)}},true);break;default:break}};Application.prototype.getXML=function(){var b=(new DOMParser()).parseFromString("<umldiagrams/>","text/xml");var d=b.getElementsByTagName("umldiagrams")[0];var a;var c;for(c in this._diagrams){a=this._diagrams[c].getXML(b);d.appendChild(a)}return b};Application.prototype.getCurrentXML=function(){var b=(new DOMParser()).parseFromString("<umldiagrams/>","text/xml");var c=b.getElementsByTagName("umldiagrams")[0];var a;a=this._diagrams[this._selected].getXML(b);c.appendChild(a);return b};Application.prototype.getXMLString=function(){return(new XMLSerializer()).serializeToString(this.getXML())};Application.prototype.getCurrentXMLString=function(){return(new XMLSerializer()).serializeToString(this.getCurrentXML())};Application.prototype.setXML=function(xml){var application=xml.getElementsByTagName("umldiagrams")[0];if(!application){alert("Not found a valid XML string");return}var xmlnodes=application.childNodes;var aux,nodeName;var i,j;for(i=0;i<xmlnodes.length;i++){nodeName=xmlnodes[i].nodeName;for(j in _acceptedDiagrams){if(nodeName==_acceptedDiagrams[j]){aux=eval("new "+nodeName+"()");aux.setXML(xmlnodes[i]);this.addDiagram(aux);break}}}};Application.prototype.setXMLString=function(a){a=a.replace(/\n/gi,"");this.setXML((new DOMParser()).parseFromString(a,"text/xml"))};_acceptedDiagrams.push("UMLClassDiagram");_genericMenu.push(["New class diagram",function(a){a.addDiagram(new UMLClassDiagram())},0,"UMLClassDiagram"]);_specificMenu.UMLClassDiagram=[["Class",function(b,a,c){b.addElement(new UMLClass({x:a,y:c}))},1,"UMLClass"],["Component",function(b,a,c){b.addElement(new UMLComponent({x:a,y:c}))},1,"UMLComponent"],["Interface",function(b,a,c){b.addElement(new UMLInterfaceExtended({x:a,y:c}))},1,"UMLInterfaceExtended"],["Package",function(b,a,c){b.addElement(new UMLPackage({x:a,y:c}))},1,"UMLPackage"],["Package container",function(b,a,c){b.addElement(new UMLPackageContainer({x:a,y:c}))},1,"UMLPackageContainer"],["Generalization",function(c,b,e,a,d){c.addRelationFromPoints(new UMLGeneralization(),b,e,a,d)},2,"UMLGeneralization"],["Association",function(c,b,e,a,d){c.addRelationFromPoints(new UMLAssociation(),b,e,a,d)},2,"UMLAssociation"],["Aggregation",function(c,b,e,a,d){c.addRelationFromPoints(new UMLAggregation(),b,e,a,d)},2,"UMLAggregation"],["Composition",function(c,b,e,a,d){c.addRelationFromPoints(new UMLComposition(),b,e,a,d)},2,"UMLComposition"],["Dependency",function(c,b,e,a,d){c.addRelationFromPoints(new UMLDependency(),b,e,a,d)},2,"UMLDependency"],["Realization",function(c,b,e,a,d){c.addRelationFromPoints(new UMLRealization(),b,e,a,d)},2,"UMLRealization"],["Usage",function(c,b,e,a,d){c.addRelationFromPoints(new UMLUsage(),b,e,a,d)},2,"UMLUsage"],["Package merge",function(c,b,e,a,d){c.addRelationFromPoints(new UMLPackageMerge(),b,e,a,d)},2,"UMLPackageMerge"],["Package public import",function(c,b,e,a,d){c.addRelationFromPoints(new UMLPackagePublicImport(),b,e,a,d)},2,"UMLPackagePublicImport"],["Package private import",function(c,b,e,a,d){c.addRelationFromPoints(new UMLPackagePrivateImport(),b,e,a,d)},2,"UMLPackagePrivateImport"]];_acceptedDiagrams.push("UMLUseCaseDiagram");_genericMenu.push(["New use case diagram",function(a){a.addDiagram(new UMLUseCaseDiagram())},0,"UMLUseCaseDiagram"]);_specificMenu.UMLUseCaseDiagram=[["Actor",function(b,a,c){b.addElement(new UMLActor({x:a,y:c}))},1,"UMLActor"],["Use case",function(b,a,c){b.addElement(new UMLUseCase({x:a,y:c}))},1,"UMLUseCase"],["UseCaseExtended",function(b,a,c){b.addElement(new UMLUseCaseExtended({x:a,y:c}))},1,"UMLUseCaseExtended"],["System",function(b,a,c){b.addElement(new UMLSystem({x:a,y:c}))},1,"UMLSystem"],["SubSystem",function(b,a,c){b.addElement(new UMLSubSystem({x:a,y:c}))},1,"UMLSubSystem"],["Communication",function(c,b,e,a,d){c.addRelationFromPoints(new UMLCommunication(),b,e,a,d)},2,"UMLCommunication"],["Extend",function(c,b,e,a,d){c.addRelationFromPoints(new UMLExtend(),b,e,a,d)},2,"UMLExtend"],["Include",function(c,b,e,a,d){c.addRelationFromPoints(new UMLInclude(),b,e,a,d)},2,"UMLInclude"],["Generalization",function(c,b,e,a,d){c.addRelationFromPoints(new UMLGeneralization(),b,e,a,d)},2,"UMLGeneralization"]];_acceptedDiagrams.push("UMLComponentDiagram");_genericMenu.push(["New component diagram",function(a){a.addDiagram(new UMLComponentDiagram())},0,"UMLComponentDiagram"]);_specificMenu.UMLComponentDiagram=[["Package",function(b,a,c){b.addElement(new UMLPackage({x:a,y:c}))},1,"UMLPackage"],["Package container",function(b,a,c){b.addElement(new UMLPackageContainer({x:a,y:c}))},1,"UMLPackageContainer"],["Component",function(b,a,c){b.addElement(new UMLComComponent({x:a,y:c}))},1,"UMLComponent"],["Add Port",function(b,a,d){var c=b.getElementByPoint(a,d);if(c!=null&&c.getType()=="UMLComComponent"){c.addPort(new UMLPort())}},1,"UMLPort"],["Interface",function(b,a,c){b.addElement(new UMLInterface({x:a,y:c}))},1,"UMLInterface"],["Interface Extended",function(b,a,c){b.addElement(new UMLInterfaceExtended({x:a,y:c}))},1,"UMLInterfaceExtended"],["Interface usage",function(c,b,e,a,d){c.addRelationFromPoints(new UMLInterfaceUsage(),b,e,a,d)},2,"UMLInterfaceUsage"],["Interface realization",function(c,b,e,a,d){c.addRelationFromPoints(new UMLInterfaceRealization(),b,e,a,d)},2,"UMLInterfaceRealization"],["Generalization",function(c,b,e,a,d){c.addRelationFromPoints(new UMLGeneralization(),b,e,a,d)},2,"UMLGeneralization"],["Component Realization",function(c,b,e,a,d){c.addRelationFromPoints(new UMLRealization(),b,e,a,d)},2,"UMLRealization"],["Connector",function(c,b,e,a,d){c.addRelationFromPoints(new UMLConnector(),b,e,a,d)},2,"UMLConnector"],];_acceptedDiagrams.push("UMLSequenceDiagram");_genericMenu.push(["New sequence diagram",function(a){a.addDiagram(new UMLSequenceDiagram())},0,"UMLSequenceDiagram"]);_specificMenu.UMLSequenceDiagram=[["Lifeline",function(b,a,c){b.addElement(new UMLLifeline({x:a,y:70}))},1,"UMLLifeline"],["Create",function(e,d,g,c,f){var b=e.getElementByPoint(d,g);var a=e.getElementByPoint(c,f);if(b&&a&&b!=a&&(b.getType()=="UMLLifeline"||b.getType()=="TimeInterval")&&a.getType()=="UMLLifeline"&&!a.getCreate()){e.addElement(new UMLCreate({a:b,b:a,y:g}))}},2,"UMLCreate"],["Destroy",function(e,d,g,c,f){var b=e.getElementByPoint(d,g);var a=e.getElementByPoint(c,f);if(b&&a&&b!=a&&(b.getType()=="UMLLifeline"||b.getType()=="TimeInterval")&&a.getType()=="UMLLifeline"&&!a.getDelete()){e.addElement(new UMLDestroy({a:b,b:a,y:g}))}},2,"UMLDestroy"],["Option",function(b,a,c){b.addElement(new UMLOption({x:a,y:c}))},1,"UMLInteraction"],["Alternative",function(b,a,c){b.addElement(new UMLAlternative({x:a,y:c}))},1,"UMLInteraction"],["Loop",function(b,a,c){b.addElement(new UMLLoop({x:a,y:c}))},1,"UMLInteraction"],["Break",function(b,a,c){b.addElement(new UMLBreak({x:a,y:c}))},1,"UMLInteraction"],["Send Message",function(e,d,g,c,f){var b=e.getElementByPoint(d,g);var a=e.getElementByPoint(c,f);if(b&&a&&(b.getType()=="UMLLifeline"||b.getType()=="TimeInterval")&&(a.getType()=="UMLLifeline"||a.getType()=="TimeInterval")){e.addElement(new UMLSendMessage({a:b,b:a,y:g}))}},2,"UMLSendMessage"],["Call Message",function(e,d,g,c,f){var b=e.getElementByPoint(d,g);var a=e.getElementByPoint(c,f);if(b&&a&&(b.getType()=="UMLLifeline"||b.getType()=="TimeInterval")&&(a.getType()=="UMLLifeline"||a.getType()=="TimeInterval")){e.addElement(new UMLCallMessage({a:b,b:a,y:g}))}},2,"UMLCallMessage"],["Reply Message",function(e,d,g,c,f){var b=e.getElementByPoint(d,g);var a=e.getElementByPoint(c,f);if(b!=a&&b!=null&&(b.getType()=="UMLLifeline"||b.getType()=="TimeInterval")&&(a.getType()=="UMLLifeline"||a.getType()=="TimeInterval")){e.addElement(new UMLReplyMessage({a:b,b:a,y:g}))}},2,"UMLReplyMessage"],["Delete Message",function(e,d,g,c,f){var b=e.getElementByPoint(d,g);var a=e.getElementByPoint(c,f);if(b&&a&&b!=a&&(b.getType()=="UMLLifeline"||b.getType()=="TimeInterval")&&a.getType()=="UMLLifeline"&&!a.getDelete()){e.addElement(new UMLDeleteMessage({a:b,b:a,y:g}))}},2,"UMLDeleteMessage"],];_acceptedDiagrams.push("UMLStateMachineDiagram");_genericMenu.push(["New State Machine diagram",function(a){a.addDiagram(new UMLStateMachineDiagram())},0,"UMLStateMachineDiagram"]);_specificMenu.UMLStateMachineDiagram=[["Initial State",function(b,a,c){b.addElement(new UMLInitialPseudostate({x:a,y:c}))},1,"UMLInitialPseudostate"],["Final State",function(b,a,c){b.addElement(new UMLFinalState({x:a,y:c}))},1,"UMLFinalState"],["Terminate",function(b,a,c){b.addElement(new UMLTerminate({x:a,y:c}))},1,"UMLTerminate"],["Entry Point",function(b,a,c){b.addElement(new UMLEntryPoint({x:a,y:c}))},1,"UMLEntryPoint"],["Exit Point",function(b,a,c){b.addElement(new UMLExitPoint({x:a,y:c}))},1,"UMLExitPoint"],["Junction",function(b,a,c){b.addElement(new UMLJunction({x:a,y:c}))},1,"UMLJunction"],["Simple State",function(b,a,c){b.addElement(new UMLSimpleState({x:a,y:c}))},1,"UMLSimpleState"],["Composite State",function(b,a,c){b.addElement(new UMLCompositeState({x:a,y:c}))},1,"UMLCompositeState"],["Vertical Region",function(b,a,c){b.addElement(new UMLVerticalRegion({x:a,y:c}))},1,"UMLVerticalRegion"],["Horizontal Region",function(b,a,c){b.addElement(new UMLHorizontalRegion({x:a,y:c}))},1,"UMLHorizontalRegion"],["Transition",function(c,b,e,a,d){c.addRelationFromPoints(new UMLTransition(),b,e,a,d)},2,"UMLTransition"]];_acceptedDiagrams.push("UMLActivityDiagram");_genericMenu.push(["New activity diagram",function(a){a.addDiagram(new UMLActivityDiagram())},0,"UMLActivityDiagram"]);_specificMenu.UMLActivityDiagram=[["AcceptEventAction",function(b,a,c){b.addElement(new UMLAcceptEventAction({x:a,y:c}))},1,"UMLAcceptEventAction"],["TimeEvent",function(b,a,c){b.addElement(new UMLTimeEvent({x:a,y:c}))},1,"UMLTimeEvent"],["SendSignalAction",function(b,a,c){b.addElement(new UMLSendSignalAction({x:a,y:c}))},1,"UMLSendSignalAction"],["Action",function(b,a,c){b.addElement(new UMLAction({x:a,y:c}))},1,"UMLAction"],["ObjectNode",function(b,a,c){b.addElement(new UMLObject({x:a,y:c}))},1,"UMLObject"],["Activity",function(b,a,c){b.addElement(new UMLActivity({x:a,y:c}))},1,"UMLActivity"],["DataStore",function(b,a,c){b.addElement(new UMLDataStore({x:a,y:c}))},1,"UMLDataStore"],["Connector",function(b,a,c){b.addElement(new UMLConnectorActivity({x:a,y:c}))},1,"UMLConnector2"],["HorizontalSwimlane",function(b,a,c){b.addElement(new UMLHorizontalSwimlane({x:a,y:c}))},1,"UMLHorizontalSwimlane"],["VerticalSwimlane",function(b,a,c){b.addElement(new UMLVerticalSwimlane({x:a,y:c}))},1,"UMLVerticalSwimlane"],["HorizontalHierarchicalSwimlane",function(b,a,c){b.addElement(new UMLHorizontalHierarchicalSwimlane({x:a,y:c}))},1,"UMLHorizontalHierarchicalSwimlane"],["VerticalHierarchicalSwimlane",function(b,a,c){b.addElement(new UMLVerticalHierarchicalSwimlane({x:a,y:c}))},1,"UMLVerticalHierarchicalSwimlane"],["Add Pin",function(b,a,d){var c=b.getElementByPoint(a,d);if(c!=null&&c.getType()=="UMLAction"){c.addPort(new UMLPin())}},1,"UMLPin"],["Parameter Node",function(b,a,d){var c=b.getElementByPoint(a,d);if(c!=null&&c.getType()=="UMLActivity"){c.addPort(new UMLParameterNode())}},1,"UMLParameterNode"],["Expansion Node",function(b,a,d){var c=b.getElementByPoint(a,d);if(c!=null&&c.getType()=="UMLAction"){c.addPort(new UMLExpansionNode())}},1,"UMLExpansionNode"],["Flow/Edge",function(c,b,f,a,e){var i=c.getElementByPoint(b,f);var h=c.getElementByPoint(a,e);var g=0;var d=0;if(i instanceof NodeForkJoin){g=(i._quadrant==1)?(b-i._x):0;d=(i._quadrant==2)?(f-i._y):0}else{if(h instanceof NodeForkJoin){g=(h._quadrant==1)?(a-h._x):0;d=(h._quadrant==2)?(e-h._y):0}}if(i&&h&&!(i instanceof NodeForkJoin&&h instanceof NodeForkJoin)){c.addElement(new UMLFlow({a:i,b:h,y:d,x:g}))}},2,"UMLFlow"],["ExceptionHandler",function(c,b,e,a,d){c.addRelationFromPoints(new UMLExceptionHandler(),b,e,a,d)},2,"UMLExceptionHandler"],["ActivityFinal",function(b,a,c){b.addElement(new UMLActivityFinal({x:a,y:c}))},1,"UMLActivityFinal"],["InitialNode",function(b,a,c){b.addElement(new UMLInitialNode({x:a,y:c}))},1,"UMLInitialNode"],["FlowFinal",function(b,a,c){b.addElement(new UMLFlowFinal({x:a,y:c}))},1,"UMLFlowFinal"],["Decision/Merge Node",function(b,a,c){b.addElement(new UMLDecision_MergeNode({x:a,y:c}))},1,"UMLDecision_MergeNode"],["Fork/Join Node",function(b,a,c){b.addElement(new UMLFork_JoinNode({x:a,y:c}))},1,"UMLFork_JoinNode"]];